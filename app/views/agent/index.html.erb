<% content_for :view_role do %>Agent<% end %>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span2">
          <div id="agent-phone-status">
            <div class="navbar navbar-info">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="brand" href="#">
                            <small>Extension status</small>
                        </a>
                    </div>
                </div>
            </div>
            <table class="table">
                <tbody>
                    <tr>
                        <td>Extension:</td>
                        <td><%= current_user.extension %></td>
                    </tr>
                    <tr>
                        <td>Status:</td>
                        <td id="ext-status"></td>
                    </tr>
                </tbody>
            </table>
          </div>
        </div>
        <div class="span10">
            
            <!-- Table with queues and their statuses -->
            <% if !@queues.empty? %>
            <table class="table table-striped table-bordered table-condensed">
                <thead>
                    <tr>
                        <th>Queue</th>
                        <th>Agent Status</th>
                        <th>Queue Count</th>
                        <th class="action-col">Action</th>
                    </tr>
                </thead>
                <tbody>
                <% @queues.each do |queue| %>
                    <tr data-queue="<%= queue.name %>">
                        <td><%= queue.name %></td>
                        <td data-queue-status="<%= "#{queue.name}-#{current_user.extension}" %>">
                                <%= @queue_statuses[queue.name]["members"].has_key?(current_user.extension) ?
                                @queue_statuses[queue.name]["members"][current_user.extension]["status"]:"Logged Off" %>
                        </td>
                        <td data-queue-count="<%= "#{queue.name}" %>"></td>
                        <td class="action-col">
                            <% if !@queue_statuses[queue.name]["members"].has_key?(current_user.extension) %>
                                <%= button_to 'Log On', agent_logon_path(:queue_id => queue.id), {:class => "btn btn-success", :remote => true} %>
                                <%= button_to 'Log Off', agent_logoff_path(:queue_id => queue.id), {:form_class => "button_to hidden", :class => "btn btn-danger", :remote => true} %>
                            <% else %>
                                <%= button_to 'Log Off', agent_logoff_path(:queue_id => queue.id), {:class => "btn btn-danger", :remote => true} %>
                                <%= button_to 'Log On', agent_logon_path(:queue_id => queue.id), {:form_class => "button_to hidden", :class => "btn btn-success", :remote => true} %>
                            <% end %>
                        </td>
                    </tr>
                <% end %>
                </tbody>
            </table>
            <% end %>
        </div>
    </div>
</div>

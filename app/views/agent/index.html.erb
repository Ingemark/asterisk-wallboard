<% content_for :view_role do %>Agent<% end %>

<div class="container-fluid">
    <div class="row-fluid">
        
        <!-- Extension status box -->
        <div class="span2">
          <%= render 'shared/ext_status' %>
        </div>
        
        <!-- Queue status table -->
        <div class="span10">
            <!-- Table with queues and their statuses -->
            <% if !@queue_statuses.empty? %>
            <table class="table table-striped table-bordered table-condensed">
                <thead>
                    <tr>
                        <th>Queue</th>
                        <th>Agent Status</th>
                        <th>Queue Count</th>
                        <th>Abandoned</th>
                        <th>Completed</th>
                        <th>Hold Time</th>
                        <th>Max</th>
                        <th>Talk Time</th>
                        <th class="action-col">Action</th>
                    </tr>
                </thead>
                <tbody>
                <% @queues.each do |queue| %>
                    <tr data-queue="<%= queue.name %>">
                        <td><%= queue.name %></td>
                        <td data-queue-status="<%= "#{queue.name}-#{current_user.extension}" %>">
                                <%= @queue_statuses[queue.name]["members"].has_key?(current_user.extension) ?
                                @queue_statuses[queue.name]["members"][current_user.extension]["status"]:"Logged Off" %>
                        </td>
                        <td data-property="count">N/A</td>
                        <td data-property="abandoned"><%= @queue_statuses[queue.name]["abandoned"] %></td>
                        <td data-property="completed"><%= @queue_statuses[queue.name]["completed"] %></td>
                        <td data-property="holdTime"><%= @queue_statuses[queue.name]["holdTime"] %></td>
                        <td data-property="max"><%= @queue_statuses[queue.name]["max"] %></td>
                        <td data-property="talkTime"><%= @queue_statuses[queue.name]["talkTime"] %></td>
                        
                        <!-- Queue actions -->
                        <td class="action-col">
                            <% if !@queue_statuses[queue.name]["members"].has_key?(current_user.extension) %>
                                <%= button_to 'Log On', agent_logon_path(:queue_id => queue.id), {:class => "btn btn-success logon-btn", :remote => true} %>
                                <%= button_to 'Log Off', agent_logoff_path(:queue_id => queue.id), {:form_class => "button_to hidden", 
                                    :class => "btn btn-danger logoff-btn", :remote => true} %>
                            <% else %>
                                <%= button_to 'Log Off', agent_logoff_path(:queue_id => queue.id), {:class => "btn btn-danger logoff-btn", :remote => true} %>
                                <%= button_to 'Log On', agent_logon_path(:queue_id => queue.id), {:form_class => "button_to hidden", 
                                    :class => "btn btn-success logon-btn", :remote => true} %>
                            <% end %>
                        </td>
                    </tr>
                <% end %>
                </tbody>
            </table>
            <% else %>
            <div class="alert alert-block">
              <h4>You are not assigned to any queue!</h4>
            </div>
            <% end %>
        </div>
    </div>
</div>
